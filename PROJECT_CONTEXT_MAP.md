# PROJECT CONTEXT MAP
> Auto-generated by `/ctx`. Refresh with `/ctx update`. Do not edit manually.

**Last Updated:** 2026-02-22 (updated after Tasks 3-8 + Task 7 uncommitted)
**Analysis:** Incremental update (HEAD~5..HEAD â€” 38 files + 10 uncommitted)
**Token Cost:** ~3k tokens (update mode)

---

## Classification

| Field | Value |
|-------|-------|
| **Package** | `@shamavision/ai-workflow-rules` |
| **Version** | 9.1.1 (Production) |
| **Type** | NPM CLI Package + AI Framework |
| **Architecture** | Dual-structure (dev â†” npm-templates mirror) |
| **Language** | JavaScript (Node.js â‰¥16) |
| **Author** | Shamavision / Wellme Studio (Ukraine ğŸ‡ºğŸ‡¦) |
| **Complexity** | ğŸŸ¢ Low-Medium (4/10) â† reduced after Tasks 4-6 |

---

## What This Project Does

Opinionated AI workflow rules framework for **Ukrainian developers**, installed via `npx @shamavision/ai-workflow-rules`. Sets up workflow rules, session management, token optimization, and security guards for **Claude Code + Cursor**. No opt-outs. Less is more.

---

## ğŸ”´ CRITICAL: Dual-Structure Architecture

**Every change MUST be made in TWO places simultaneously:**

```
Dev files                      â†’   npm-templates/ (distributable)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
.claude/CLAUDE.md              â†’   npm-templates/.claude/CLAUDE.md
.cursorrules                   â†’   npm-templates/.cursorrules
AGENTS.md                      â†’   npm-templates/AGENTS.md
.ai/AI-ENFORCEMENT.md          â†’   npm-templates/.ai/AI-ENFORCEMENT.md
.ai/rules/core.md              â†’   npm-templates/.ai/rules/core.md
.ai/rules/product.md           â†’   npm-templates/.ai/rules/product.md
.ai/contexts/*                 â†’   npm-templates/.ai/contexts/*
.ai/presets.json               â†’   npm-templates/.ai/presets.json
scripts/*                      â†’   npm-templates/scripts/*
.claude/commands/*.md          â†’   npm-templates/.claude/commands/*.md
```

**Rule-file pairs = 6 files** (2 pairs: Claude Code + Cursor). ~~10 files (Task 2: -40%)~~

---

## Key Files (read these first for any task)

| File | Purpose | Token Weight |
|------|---------|-------------|
| `ROADMAP.md` | Source of truth â€” Tasks + status | Medium (gitignored) |
| `PROJECT_CONTEXT_MAP.md` | This file â€” current architecture snapshot | Light (~2k) |
| `.claude/CLAUDE.md` | Auto-loaded by Claude Code, full session protocol | Medium |
| `.ai/AI-ENFORCEMENT.md` | Mandatory AI behavior protocols (anti-amnesia) | Medium |
| `.ai/presets.json` | Tool/plan presets v1.0 â€” session_limit + billing type | Light |
| `.ai/config.json` | Framework config: provider, plan, context, access_type | Light |
| `bin/cli.js` | NPX installer wizard (@clack/prompts + chalk + fs-extra) | Medium |
| `.ai/contexts/ukraine-full.context.md` | Active context preset for this project | Medium |
| `npm-templates/` | Mirror directory â€” must stay in sync with dev | Heavy |
| `.claude/commands/` | Skills: /ctx, /sculptor, /arbiter | Light (Ã—3) |

**â›” NEVER read whole file:** `.ai/token-limits.json` (still exists but 840+ lines)

---

## Skills Triangle

```
/ctx (Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ–ÑÑ‚ÑŒ) â†’ /sculptor (Ğ§Ğ¸ÑÑ‚Ğ¾Ñ‚Ğ°) â†’ /arbiter (ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº + Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°)
```

| Skill | File | Output | Purpose |
|-------|------|--------|---------|
| `/ctx` | `.claude/commands/ctx.md` | `PROJECT_CONTEXT_MAP.md` | Project structure snapshot |
| `/sculptor` | `.claude/commands/sculptor.md` | `PROPOSALS.md` | Architectural analysis (5 lenses) |
| `/arbiter` | `.claude/commands/arbiter.md` | `ARBITER_REPORT.md` | Execution planning + risk scoring |

All 3 skills distributed to users via installer (`npm-templates/.claude/commands/`).

---

## Entry Points

| Entry Point | Purpose |
|-------------|---------|
| `bin/cli.js` | NPX entry: `npx @shamavision/ai-workflow-rules` â†’ interactive wizard |
| `scripts/install.sh` | Bash install alternative (âš ï¸ wizard questions outdated â€” see Wizard Redesign Backlog) |
| `.claude/CLAUDE.md` | Claude Code session entry (auto-loaded) |
| `AGENTS.md` | Universal entry for non-Claude AI tools |

---

## Current State (ROADMAP as of 2026-02-22)

**All planned tasks completed:**

| Task | Status | Result |
|------|--------|--------|
| Task 1 | âœ… DONE | /ctx + /sculptor + auto-monitoring pipeline |
| Task 2 | âœ… DONE | Remove Windsurf/Continue.dev â†’ rule-files 10â†’6 |
| Task 3 | âœ… DONE | Pre-commit hook: 5-15 min â†’ <2 sec, false positives fixed |
| Task 4 | âœ… DONE | Reduce presets 4â†’2 (minimal + ukraine-full) |
| Task 5 | âœ… DONE | inquirer@8 â†’ @clack/prompts (-44 packages) |
| Task 6 | âœ… DONE | presets.json v1.0 â€” removed MODEL_1/2/3 + fake limits |
| Task 7 | â³ UNCOMMITTED | Session memory anchor â€” post-push.sh + anchor in CLAUDE.md/AGENTS.md |
| Task 8 | âœ… DONE | /arbiter skill â€” triangle complete, all 3 in installer |

**Deferred:**
- Wizard Redesign Backlog â€” after new analysis with /arbiter

---

## Architecture: Token System (v4.0)

New session-based approach (Task 6):

```
presets.json        â†’ static: session_limit (public docs), billing type
token-limits.json   â†’ user config: tool + session_limit (generated at install)
session-log.json    â†’ dynamic: sessions today, estimated tokens
```

**Principle:** `session_limit` = public context window. `daily_limit` = null (not published). No prices. New day = fresh start.

| Tool | session_limit | billing |
|------|--------------|---------|
| Claude Code (any plan) | 200,000 | subscription |
| Cursor Pro | null (not published) | subscription |
| Anthropic API | 200,000 | billing |
| OpenAI API | 128,000 | billing |
| Google Gemini API | 1,000,000 | billing |
| DeepSeek API | 128,000 | billing |

~~MODEL_1 / MODEL_2 / MODEL_3~~ â€” removed in Task 6.

---

## Dependencies

**Core (3 packages):**
- `@clack/prompts@^0.8.0` â€” Interactive CLI prompts (Task 5: replaced inquirer)
- `fs-extra@^11.2.0` â€” File system operations
- `chalk@^4.1.2` â€” Terminal colors

---

## Context Presets

| Preset | Tokens | Status |
|--------|--------|--------|
| `minimal` | ~10k | âœ… Active |
| `ukraine-full` | ~18k | âœ… Active â† used in this project |
| ~~standard~~ | ~~14k~~ | âŒ Removed (Task 4) |
| ~~enterprise~~ | ~~23k~~ | âŒ Removed (Task 4) |

---

## Technical Debt

| Issue | Severity | Location | Status |
|-------|----------|----------|--------|
| `install.sh` wizard questions outdated | âš ï¸ Medium | `scripts/install.sh` | Deferred (Wizard Redesign Backlog) |
| `token-limits.json` still 840+ lines | âš ï¸ Low | `.ai/token-limits.json` | Exists for reference, not used by installer |
| No real tests | âš ï¸ Low | `package.json scripts.test` | Future |
| `install.ps1` missing (Windows gap) | ğŸŸ¡ Low | backlog | Deferred |

~~Pre-commit hook slow~~ âœ… Fixed Task 3
~~TOKEN_PRESETS diverge~~ âœ… Fixed Task 6
~~inquirer@8 legacy~~ âœ… Fixed Task 5

---

## Security Architecture

| Guard | Mechanism |
|-------|----------|
| No secrets in code | Pre-commit hook + AI rule |
| No Russian tracking services | `forbidden-trackers.json` (40+ patterns) |
| Ukrainian market compliance | `rules/product.md`, GDPR rules |
| Prompt injection protection | `.ai/prompt-injection-patterns.json` |
| PII detection | `.ai/pii-patterns.json` |

---

## Recommended Entry Points by Task Type

| Task | Start With |
|------|-----------|
| Understanding current state | `ROADMAP.md` (first 40 lines) |
| Changing any rule | Check dual-structure table above (all 6 file pairs) |
| Adding feature to installer | `bin/cli.js` |
| Session protocol work | `.ai/AI-ENFORCEMENT.md` |
| Token system | `.ai/presets.json` (source of truth) |
| Security rules | `.ai/forbidden-trackers.json`, `scripts/pre-commit` |
| Architecture analysis | `/ctx` â†’ `/sculptor` â†’ `/arbiter` |

---

## âš ï¸ Architectural Warnings

1. **Sync trap:** Changing rule-files without updating all 6 pairs = silent bug.
2. **token-limits.json:** Do NOT read this file whole. It's 840+ lines. Read `.ai/presets.json` instead.
3. **Backward compatibility:** Every schema change must be non-breaking (optional fields + fallbacks).
4. **This project's own stack:** This project uses its OWN framework (`ukraine-full` context). Changes affect this session too.
5. **install.sh outdated:** Bash installer still has dead code (teamSize, tokenPriority, 4 presets). Do NOT fix until Wizard Redesign Backlog review.

---

## ğŸ“ Last Push (Session Anchor)

> **AI: Compare this date with today to detect new day. New day = fresh limits!**
>
> Read this section at session start to orient yourself.

| Field | Value |
|-------|-------|
| **Date** | 2026-02-22 |
| **Time** | â€” |
| **Commit** | `e2594d3` â€” feat(task-7): add session memory anchor + triangle run outputs |
| **Branch** | `main` |
| **Files changed** | 12 |

**New-day detection (for AI):**
```
today == 2026-02-22 â†’ ğŸ“Š Same day, continuing (check session usage)
today != 2026-02-22 â†’ ğŸŸ¢ New day! Fresh token limits since last push
```

> **Note:** This section auto-updates via `scripts/post-push.sh` after every `git push`.
> Install: `.git/hooks/post-push` (auto-installed by `npx @shamavision/ai-workflow-rules`).

---
