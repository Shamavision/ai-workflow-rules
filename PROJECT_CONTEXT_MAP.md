# PROJECT CONTEXT MAP
> Auto-generated by `/ctx`. Refresh with `/ctx update`. Do not edit manually.

**Last Updated:** 2026-02-21 (updated after Task 1+2)
**Analysis:** Incremental update (git diff HEAD~3)
**Token Cost:** ~3k tokens (update mode)

---

## Classification

| Field | Value |
|-------|-------|
| **Package** | `@shamavision/ai-workflow-rules` |
| **Version** | 9.1.1 (Production) |
| **Type** | NPM CLI Package + AI Framework |
| **Architecture** | Dual-structure (dev â†” npm-templates mirror) |
| **Language** | JavaScript (Node.js â‰¥14) |
| **Author** | Shamavision / Wellme Studio (Ukraine ğŸ‡ºğŸ‡¦) |
| **Complexity** | ğŸŸ¡ Medium (5/10) â† reduced after Task 2 |

---

## What This Project Does

Opinionated AI workflow rules framework for **Ukrainian developers**, installed via `npx @shamavision/ai-workflow-rules`. Sets up workflow rules, session management, token optimization, and security guards for **Claude Code + Cursor**. No opt-outs. Less is more.

---

## ğŸ”´ CRITICAL: Dual-Structure Architecture (Task 2 updated)

**Every change MUST be made in TWO places simultaneously:**

```
Dev files           â†’   npm-templates/ (distributable)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
.claude/CLAUDE.md   â†’   npm-templates/.claude/CLAUDE.md
.cursorrules        â†’   npm-templates/.cursorrules
AGENTS.md           â†’   npm-templates/AGENTS.md
.ai/AI-ENFORCEMENT  â†’   npm-templates/.ai/AI-ENFORCEMENT.md
.ai/rules/core.md   â†’   npm-templates/.ai/rules/core.md
.ai/rules/product   â†’   npm-templates/.ai/rules/product.md
.ai/contexts/*      â†’   npm-templates/.ai/contexts/*
scripts/*           â†’   npm-templates/scripts/*
```

**Rule-file pairs = 6 files** (2 pairs: Claude Code + Cursor). ~~10 files (Task 2: -40%)~~

---

## Key Files (read these first for any task)

| File | Purpose | Token Weight |
|------|---------|-------------|
| `ROADMAP.md` | Source of truth â€” Tasks 1-7 + status | Medium (gitignored) |
| `PROJECT_CONTEXT_MAP.md` | This file â€” current architecture snapshot | Light (~2k) |
| `.claude/CLAUDE.md` | Auto-loaded by Claude Code, full session protocol | Medium |
| `.ai/AI-ENFORCEMENT.md` | Mandatory AI behavior protocols (anti-amnesia) | Medium |
| `.ai/config.json` | Framework config: provider, plan, access_type | Light |
| `bin/cli.js` | NPX installer wizard (inquirer + chalk + fs-extra) | Medium |
| `.ai/contexts/ukraine-full.context.md` | Active context preset for this project | Medium |
| `npm-templates/` | Mirror directory â€” must stay in sync with dev | Heavy |
| `.claude/commands/ctx.md` | /ctx skill â€” project context analysis | Light |
| `.claude/commands/sculptor.md` | /sculptor skill â€” architectural analysis | Light |

**â›” NEVER read whole file:** `.ai/token-limits.json` (840+ lines, ~15k tokens alone)

---

## Entry Points

| Entry Point | Purpose |
|-------------|---------|
| `bin/cli.js` | NPX entry: `npx @shamavision/ai-workflow-rules` â†’ interactive wizard |
| `scripts/install.sh` | Bash install alternative |
| `.claude/CLAUDE.md` | Claude Code session entry (auto-loaded) |
| `AGENTS.md` | Universal entry for non-Claude AI tools |

---

## Current State (ROADMAP as of 2026-02-21)

**Completed:**
- âœ… Task 1: /ctx + /sculptor skills + auto-monitoring hook pipeline
- âœ… Task 2: Remove Windsurf/Continue.dev â†’ Claude Code + Cursor only (rule-files 10â†’6)

**Active / Next:**
| Task | Status | Description |
|------|--------|-------------|
| Task 3 | ğŸ”´ Next | Fix pre-commit hook: speed (<10s) + LANG-CRITICAL false positives |
| Task 4 | ğŸŸ¡ Planned | Reduce presets: 4â†’2 (minimal + ukraine-full) |
| Task 5 | ğŸŸ¡ Planned | Replace inquirer@8 â†’ @clack/prompts |
| Task 6 | ğŸŸ¡ Planned | TOKEN_PRESETS deduplication (bin/cli.js â†” JSON) |
| Task 7 | â³ Deferred | Session memory anchor (recalculate after Task 2-4) |

---

## Architecture: Token Management System

Three-layer model:

```
Context Layer  â†’ Session window % (AI knows exactly: X / 200k)
Rate Layer     â†’ Provider throttling (estimated: Normal / High load)
Billing Layer  â†’ Financial (N/A for subscription, $X.XX for API billing)
```

**2 Architecture Models (Task 2: MODEL_2 removed):**
- `MODEL_1`: Hard Token Billing â€” API providers (Anthropic, Mistral, Google, DeepSeek)
- `MODEL_3`: Fair Use Dynamic â€” Claude Pro, Cursor (limits UNKNOWN by design)

---

## Dependencies

**Core (3 packages):**
- `inquirer@^8.2.6` â€” Interactive CLI prompts âš ï¸ Legacy (Task 5: migrate to @clack/prompts)
- `fs-extra@^11.2.0` â€” File system operations
- `chalk@^4.1.2` â€” Terminal colors

---

## Technical Debt

| Issue | Severity | Location | Task |
|-------|----------|----------|------|
| Pre-commit hook: 5-15 min per commit | ğŸ”´ High | `scripts/pre-commit` | Task 3 |
| LANG-CRITICAL false positives (.ru in rule text) | ğŸ”´ High | `scripts/pre-commit` | Task 3 |
| `token-limits.json` is 840+ lines | âš ï¸ Medium | `.ai/token-limits.json` | Future |
| `bin/cli.js` TOKEN_PRESETS diverge from token-limits.json | âš ï¸ Medium | `bin/cli.js:15-45` | Task 6 |
| `inquirer@^8` is legacy (v9+ changed API) | âš ï¸ Medium | `package.json` | Task 5 |
| No real tests | âš ï¸ Medium | `package.json scripts.test` | Future |
| `install.ps1` missing (Windows gap) | ğŸŸ¡ Low | backlog | Deferred |

---

## Security Architecture

| Guard | Mechanism |
|-------|----------|
| No secrets in code | Pre-commit hook + AI rule |
| No Russian tracking services | `forbidden-trackers.json` (40+ patterns) |
| Ukrainian market compliance | `rules/product.md`, GDPR rules |
| Prompt injection protection | `.ai/prompt-injection-patterns.json` |
| PII detection | `.ai/pii-patterns.json` |

---

## Context Presets (4 â†’ 2 planned in Task 4)

| Preset | Tokens | Status |
|--------|--------|--------|
| `minimal` | ~10k | âœ… Keep |
| `standard` | ~14k | âŒ Remove (Task 4) |
| `ukraine-full` | ~18k | âœ… Keep â† ACTIVE |
| `enterprise` | ~23k | âŒ Remove (Task 4) |

---

## Recommended Entry Points by Task Type

| Task | Start With |
|------|-----------|
| Understanding current state | `ROADMAP.md` (first 60 lines) |
| Changing any rule | Check 6-file pair table above |
| Adding feature to installer | `bin/cli.js` |
| Session protocol work | `.ai/AI-ENFORCEMENT.md` |
| Token system changes | `.ai/config.json` |
| Security rules | `.ai/forbidden-trackers.json`, `scripts/pre-commit` |
| Architecture analysis | `/sculptor` â†’ `PROPOSALS.md` |

---

## âš ï¸ Architectural Warnings

1. **Sync trap:** Changing rule-files without updating all 6 pairs = silent bug. ~~10~~ â†’ 6 files now.
2. **token-limits.json:** Do NOT read this file whole. It's 840+ lines. Read `.ai/config.json` instead.
3. **Backward compatibility:** Every schema change must be non-breaking (optional fields + fallbacks).
4. **This project's own stack:** This project uses its OWN framework (`ukraine-full` context). Changes to the framework affect this session too.
5. **Pre-commit hook:** Currently slow (5-15 min). Task 3 will fix this.
