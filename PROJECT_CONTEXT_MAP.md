# PROJECT CONTEXT MAP
> Auto-generated by `/ctx`. Refresh with `/ctx update`. Do not edit manually.

**Last Updated:** 2026-02-21
**Analysis:** Full scan (Phases 1-4)
**Token Cost:** ~12k tokens

---

## Classification

| Field | Value |
|-------|-------|
| **Package** | `@shamavision/ai-workflow-rules` |
| **Version** | 9.1.1 (Production) |
| **Type** | NPM CLI Package + AI Framework |
| **Architecture** | Dual-structure (dev â†” npm-templates mirror) |
| **Language** | JavaScript (Node.js â‰¥14) |
| **Author** | Shamavision / Wellme Studio (Ukraine ğŸ‡ºğŸ‡¦) |
| **Complexity** | ğŸ”´ High (7/10) |

---

## What This Project Does

Universal AI workflow rules framework, installed via `npx @shamavision/ai-workflow-rules`. Sets up workflow rules, session management, token optimization, and security guards for AI coding assistants (Claude Code, Cursor, Windsurf, Continue.dev, GitHub Copilot, and more). Target market: Ukrainian developers + global.

---

## ğŸ”´ CRITICAL: Dual-Structure Architecture

**Every change MUST be made in TWO places simultaneously:**

```
Dev files           â†’   npm-templates/ (distributable)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
.claude/CLAUDE.md   â†’   npm-templates/.claude/CLAUDE.md
.cursorrules        â†’   npm-templates/.cursorrules
.windsurfrules      â†’   npm-templates/.windsurfrules
.continuerules      â†’   npm-templates/.continuerules
AGENTS.md           â†’   npm-templates/AGENTS.md
.ai/AI-ENFORCEMENT  â†’   npm-templates/.ai/AI-ENFORCEMENT.md
.ai/rules/core.md   â†’   npm-templates/.ai/rules/core.md
.ai/rules/product   â†’   npm-templates/.ai/rules/product.md
.ai/contexts/*      â†’   npm-templates/.ai/contexts/*
scripts/*           â†’   npm-templates/scripts/*
```

**Rule-file pairs = 10 files** (5 pairs). Missing one = broken user experience.

---

## Key Files (read these first for any task)

| File | Purpose | Token Weight |
|------|---------|-------------|
| `ROADMAP.md` | Source of truth for all phases + current status | Medium |
| `.claude/CLAUDE.md` | Auto-loaded by Claude Code, full session protocol | Medium |
| `.ai/AI-ENFORCEMENT.md` | Mandatory AI behavior protocols (anti-amnesia) | Medium |
| `.ai/config.json` | Framework config: provider, plan, access_type | Light |
| `bin/cli.js` | NPX installer wizard (inquirer + chalk + fs-extra) | Medium |
| `QUICK_CONTEXT.md` | 30-rule compressed context for session start | Medium |
| `.ai/contexts/ukraine-full.context.md` | Active context preset for this project | Medium |
| `npm-templates/` | Mirror directory â€” must stay in sync with dev | Heavy |
| `CHANGELOG.md` | Version history + philosophy | Light |

**â›” NEVER read whole file:** `.ai/token-limits.json` (840+ lines, ~15k tokens alone)

---

## Entry Points

| Entry Point | Purpose |
|-------------|---------|
| `bin/cli.js` | NPX entry: `npx @shamavision/ai-workflow-rules` â†’ interactive wizard |
| `scripts/install.sh` | Bash install alternative |
| `.claude/CLAUDE.md` | Claude Code session entry (auto-loaded) |
| `AGENTS.md` | Universal entry for non-Claude AI tools |
| `QUICK_CONTEXT.md` | Lightweight session context loader |

---

## Current State (ROADMAP)

**Completed (as of 2026-02-21):**
- âœ… Phase 14: 3-Layer Mental Model (Context/Rate/Billing)
- âœ… Phase 15: Burst Detection (`context_pct` in session-log)
- âœ… Phase 16: API/Subscription split in config.json
- âœ… Phase 16.5: Continue.dev support

**Active / Remaining:**
| Phase | Status | Description |
|-------|--------|-------------|
| Phase 10 | â³ Blocked | Bash install feedback from ĞºÑ€Ğ¾Ğ»Ğ¸Ğº user â€” awaiting |
| Phase 12 | ğŸ”´ Planned | README polish + cross-AI validation |
| Phase 13 | ğŸ”´ Planned | `sync-rules.sh --update` (auto-update mechanism) |

**v9.2 Backlog:**
| Idea | Priority |
|------|----------|
| `install.ps1` (Windows PowerShell) | ğŸ”´ High |
| GitHub Actions CI | ğŸŸ¡ Medium |
| Auto-context selector | ğŸ”µ Low |
| v10.0: TypeScript CLI rewrite | ğŸ”µ Very Low |

---

## Architecture: Token Management System

Three-layer model (Phase 14 implemented):

```
Context Layer  â†’ Session window % (AI knows exactly: X / 200k)
Rate Layer     â†’ Provider throttling (estimated: Normal / High load)
Billing Layer  â†’ Financial (N/A for subscription, $X.XX for API billing)
```

**3 Architecture Models for providers:**
- `MODEL_1`: Hard Token Billing â€” API providers (Anthropic, Mistral, Google, DeepSeek)
- `MODEL_2`: Request Quota â€” GitHub Copilot (300 premium requests/month)
- `MODEL_3`: Fair Use Dynamic â€” Claude Pro, Cursor, Windsurf (limits UNKNOWN by design)

**config.json key:**
```json
"access_type": "subscription"  â†’  Billing Layer = N/A (honest)
"access_type": "billing"        â†’  Billing Layer = calculated cost
```

---

## Dependencies

**Core (3 packages):**
- `inquirer@^8.2.6` â€” Interactive CLI prompts (installer wizard)
- `fs-extra@^11.2.0` â€” File system operations (copy templates)
- `chalk@^4.1.2` â€” Terminal colors

**Dev:** No devDependencies defined (minimal setup)

**âš ï¸ Risk:** `inquirer@^8` is legacy (v9+ changed API). Lock version or migrate.

---

## Technical Debt

| Issue | Severity | Location |
|-------|----------|----------|
| `token-limits.json` is 840+ lines | âš ï¸ Medium | `.ai/token-limits.json` |
| `bin/cli.js` TOKEN_PRESETS diverge from token-limits.json | âš ï¸ Medium | `bin/cli.js:15-57` |
| No real tests (only `node bin/cli.js --help`) | âš ï¸ Medium | `package.json scripts.test` |
| `install.ps1` missing (Windows PowerShell gap) | ğŸ”´ High | v9.2 backlog |
| Phase 10 blocked on external feedback | â³ External | Bash install ĞºÑ€Ğ¾Ğ»Ğ¸Ğº |

---

## Security Architecture

| Guard | Mechanism |
|-------|----------|
| No secrets in code | Pre-commit hook + AI rule |
| No Russian tracking services | `forbidden-trackers.json` (40+ patterns) |
| Ukrainian market compliance | `rules/product.md`, GDPR rules |
| Prompt injection protection | `.ai/prompt-injection-patterns.json` |
| PII detection | `.ai/pii-patterns.json` |

---

## Context Presets (4 levels)

| Preset | Tokens | Use When |
|--------|--------|----------|
| `minimal` | ~10k | Simple tasks, low budget |
| `standard` | ~14k | Regular development |
| `ukraine-full` | ~18k | Ukrainian market + full rules â† ACTIVE |
| `enterprise` | ~23k | Enterprise, full compliance |

**Active preset for this project:** `ukraine-full`

---

## Recommended Entry Points by Task Type

| Task | Start With |
|------|-----------|
| Understanding current state | `ROADMAP.md` (first 60 lines) |
| Changing any rule | Check 10-file pair table above |
| Adding feature to installer | `bin/cli.js` |
| Session protocol work | `.ai/AI-ENFORCEMENT.md` |
| Token system changes | `.ai/config.json` + ROADMAP Phase context |
| Security rules | `.ai/forbidden-trackers.json`, `scripts/pre-commit` |
| Documentation | `QUICK_CONTEXT.md`, `.ai/docs/` |

---

## âš ï¸ Architectural Warnings

1. **Sync trap:** Changing rule-files without updating all 10 pairs = silent bug. Always verify both dev + npm-templates.
2. **token-limits.json:** Do NOT read this file whole. It's 840+ lines. Read `.ai/config.json` instead.
3. **Backward compatibility:** Every schema change must be non-breaking (optional fields + fallbacks).
4. **Phase dependencies:** Check ROADMAP for phase order before starting new phase.
5. **This project's own stack:** This project uses its OWN framework (`ukraine-full` context). Changes to the framework affect this session too.
