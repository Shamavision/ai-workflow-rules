# PROJECT CONTEXT MAP
> Auto-generated by `/ctx all`. Refresh with `/ctx update`. Do not edit manually.

**Last Updated:** 2026-02-23
**Analysis Mode:** Full scan (Phase 1-5)
**Token Cost:** ~12k tokens

---

## Classification

| Field | Value |
|-------|-------|
| **Package** | `@shamavision/ai-workflow-rules` |
| **Version** | 9.1.1 (Production) |
| **Type** | NPM CLI Package + AI Framework |
| **Architecture** | Dual-structure (dev â†” npm-templates mirror) |
| **Language** | JavaScript (Node.js â‰¥16) + Bash |
| **Author** | Shamavision / Wellme Studio (Ukraine ðŸ‡ºðŸ‡¦) |
| **License** | GPL-3.0 |
| **Complexity** | ðŸŸ¡ Medium (5/10) â€” 100+ files, mostly config/docs; 3 real code files |

---

## What This Project Does

Opinionated AI workflow rules framework for **Ukrainian developers**, installed via `npx @shamavision/ai-workflow-rules`. Sets up workflow rules, session discipline, token optimization, and security guards for **Claude Code + Cursor + any AI**. No opt-outs. Less is more.

Full vision: see `PROJECT_IDEOLOGY.md`.

---

## ðŸ”´ CRITICAL: Dual-Structure Architecture

**Every change to rule-files MUST be made in TWO places simultaneously:**

```
Dev files                          â†’   npm-templates/ (distributable)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
.claude/CLAUDE.md                  â†’   npm-templates/.claude/CLAUDE.md
.cursor/rules/ai-workflow.mdc      â†’   npm-templates/.cursor/rules/ai-workflow.mdc
.cursorrules                       â†’   npm-templates/.cursorrules
AGENTS.md                          â†’   npm-templates/AGENTS.md
.ai/AI-ENFORCEMENT.md              â†’   npm-templates/.ai/AI-ENFORCEMENT.md
.ai/rules/core.md                  â†’   npm-templates/.ai/rules/core.md
.ai/rules/product.md               â†’   npm-templates/.ai/rules/product.md
.ai/contexts/*                     â†’   npm-templates/.ai/contexts/*
.ai/presets.json                   â†’   npm-templates/.ai/presets.json
scripts/pre-commit                 â†’   npm-templates/scripts/pre-commit
scripts/post-push.sh               â†’   npm-templates/scripts/post-push.sh
scripts/sync-rules.sh              â†’   npm-templates/scripts/sync-rules.sh
.claude/commands/*.md              â†’   npm-templates/.claude/commands/*.md
PROJECT_IDEOLOGY.md (template)     â†’   npm-templates/PROJECT_IDEOLOGY.md
```

**Rule-file pairs = 8+ files** (4 pairs: Claude Code + Cursor â‰¥0.45 + Cursor legacy + AGENTS.md).
> **ROADMAP source of truth for pairs:** always verify against `ROADMAP.md` â†’ ÐšÐ°Ñ€Ñ‚Ð° Ñ„Ð°Ð¹Ð»Ñ–Ð².

---

## Key Files (read these first for any task)

| File | Purpose | Token Weight |
|------|---------|-------------|
| `PROJECT_IDEOLOGY.md` | Soul doc â€” WHY/WHO/PRODUCT/PRINCIPLES/VISION | Light (~3k) |
| `ROADMAP.md` | Source of truth â€” tasks, file pairs, status | Light (~1k) |
| `PROJECT_CONTEXT_MAP.md` | This file â€” current architecture snapshot | Light (~3k) |
| `.claude/CLAUDE.md` | Auto-loaded by Claude Code, full session protocol | Medium |
| `.ai/AI-ENFORCEMENT.md` | Mandatory AI behavior protocols (anti-amnesia) | Medium |
| `.ai/presets.json` | Tool/plan presets v1.0 â€” session_limit + billing type | Light |
| `.ai/config.json` | Framework config: provider, plan, context, access_type | Light |
| `bin/cli.js` | NPX installer wizard (@clack/prompts + chalk + fs-extra) | Medium |
| `npm-templates/` | Mirror directory â€” must stay in sync with dev | Heavy |
| `.claude/commands/` | Skills: /ctx, /sculptor, /arbiter | Light (Ã—3) |

**â›” NEVER read whole file:** `.ai/token-limits.json` (840+ lines)

---

## Skills Triangle

```
/ctx (Ð ÐµÐ°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ) â†’ /sculptor (Ð§Ð¸ÑÑ‚Ð¾Ñ‚Ð°) â†’ /arbiter (ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº + Ð‘ÐµÐ·Ð¿ÐµÐºÐ°)
```

| Skill | File | Output | What It Does |
|-------|------|--------|--------------|
| `/ctx` | `.claude/commands/ctx.md` | `PROJECT_CONTEXT_MAP.md` + `PROJECT_IDEOLOGY.md` | Full project scan + ideology capture |
| `/sculptor` | `.claude/commands/sculptor.md` | `PROPOSALS.md` | 5-lens analysis + mandatory WebSearch + ideology alignment |
| `/arbiter` | `.claude/commands/arbiter.md` | `ARBITER_REPORT.md` | Execution order + risk scoring + ideology conflict detection |

**All 3 skills distributed to users** via installer (`npm-templates/.claude/commands/`).

---

## Entry Points

| Entry Point | Purpose |
|-------------|---------|
| `bin/cli.js` | NPX entry: `npx @shamavision/ai-workflow-rules` â†’ 3-question wizard (provider â†’ plan â†’ market) |
| `scripts/install.sh` | Bash install alternative â€” 3-question wizard (parity with cli.js) |
| `.claude/CLAUDE.md` | Claude Code session entry (auto-loaded at session start) |
| `AGENTS.md` | Universal entry for non-Claude AI tools (Cursor, web AI) |
| `PROJECT_IDEOLOGY.md` | Full project vision â€” send here to orient any AI quickly |

---

## Current State

**All planned tasks completed. No active tasks.**

> History in `CHANGELOG.md` and `ROADMAP.md` â†’ ÐÑ€Ñ…Ñ–Ð².

**Optional backlog (low priority):**
- `/pipeline` skill â€” automate `/ctx â†’ /sculptor â†’ /arbiter`
- Cross-AI validation â€” test skills in Cursor/Windsurf

---

## Architecture: Token System (v4.0)

```
presets.json        â†’ static: session_limit (public docs), billing type
token-limits.json   â†’ user config: generated at install (not in npm-templates)
session-log.json    â†’ dynamic: sessions today, estimated tokens
```

**Principle:** `session_limit` = public context window. `daily_limit` = null (not published). New day = fresh start.

| Tool | session_limit | billing |
|------|--------------|---------|
| Claude Code (any plan) | 200,000 | subscription |
| Cursor Pro | null (not published) | subscription |
| Anthropic API | 200,000 | api |
| OpenAI API | 128,000 | api |
| Google Gemini API | 1,000,000 | api |
| DeepSeek API | 128,000 | api |

---

## Dependencies

**Core (3 packages):**
- `@clack/prompts@^0.8.0` â€” Interactive CLI prompts
- `fs-extra@^11.2.0` â€” File system operations
- `chalk@^4.1.2` â€” Terminal colors

**Dev:** none declared (uses dev machine's Node.js directly).

---

## Context Presets

| Preset | Tokens | Status |
|--------|--------|--------|
| `minimal` | ~10k | âœ… Active |
| `ukraine-full` | ~18k | âœ… Active â† used in this project |

---

## Technical Debt

| Issue | Severity | Location | Notes |
|-------|----------|----------|-------|
| No real tests | âš ï¸ Low | `package.json scripts.test` | `test` just runs `--help` |

---

## Security Architecture

| Guard | Mechanism |
|-------|----------|
| No secrets in code | Pre-commit hook + AI behavior rule |
| No Russian tracking services | `forbidden-trackers.json` (40+ patterns, LANG-CRITICAL) |
| Ukrainian market compliance | `.ai/rules/product.md`, GDPR rules |
| Prompt injection protection | `.ai/prompt-injection-patterns.json` |
| PII detection | `.ai/pii-patterns.json` |
| API key protection | Pre-commit hook + CLAUDE.md rule |

---

## Recommended Entry Points by Task Type

| Task | Start With |
|------|-----------|
| Understand project vision | `PROJECT_IDEOLOGY.md` (soul doc â€” single source of truth) |
| Understand current state | `ROADMAP.md` (first 40 lines) |
| Changing any rule-file | Check dual-structure table above (all 8+ file pairs) |
| Adding feature to installer | `bin/cli.js` (NPX) + `scripts/install.sh` (Bash) â€” keep parity |
| Session protocol work | `.ai/AI-ENFORCEMENT.md` |
| Token system | `.ai/presets.json` (source of truth) |
| Security rules | `.ai/forbidden-trackers.json`, `scripts/pre-commit` |
| Architecture analysis | `/ctx` â†’ `/sculptor` â†’ `/arbiter` |

---

## âš ï¸ Architectural Warnings

1. **Sync trap:** Changing rule-files without updating all 8+ pairs = silent bug. Always check ROADMAP.md â†’ ÐšÐ°Ñ€Ñ‚Ð° Ñ„Ð°Ð¹Ð»Ñ–Ð² first.
2. **token-limits.json:** Do NOT read this file whole. It's 840+ lines. Read `.ai/presets.json` instead.
3. **Backward compatibility:** Every schema change must be non-breaking (optional fields + fallbacks).
4. **This project's own stack:** This project uses its OWN framework (`ukraine-full` context). Changes affect this session too.
5. **Scripts discipline:** `scripts/` has 4 active files only (`pre-commit`, `post-push.sh`, `sync-rules.sh`, `install.sh`). Do not add without removing something.

---

## ðŸ“ Last Push (Session Anchor)

> **AI: Compare this date with today to detect new day. New day = fresh limits!**
>
> Read this section at session start to orient yourself.

| Field | Value |
|-------|-------|
| **Date** | 2026-02-23 |
| **Time** | â€” |
| **Commit** | `aae9794` â€” docs(roadmap): archive round 2+3, clean ROADMAP |
| **Branch** | `main` |
| **Files changed** | 1 (ROADMAP.md cleanup) |

**New-day detection (for AI):**
```
today == 2026-02-23 â†’ ðŸ“Š Same day, continuing (check session usage)
today != 2026-02-23 â†’ ðŸŸ¢ New day! Fresh token limits since last push
```

> **Note:** This section auto-updates via `scripts/post-push.sh` after every `git push`.
> Install: `.git/hooks/post-push` (auto-installed by `npx @shamavision/ai-workflow-rules`).

---
