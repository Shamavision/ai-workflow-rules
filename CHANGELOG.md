# Changelog

All notable changes to AI Workflow Rules Framework will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

---

## [Unreleased] ‚Äî 2026-02-23 (Round 4 + Round 3 + Round 2)

### Round 4: Cleanup Sprint (Task 14)

- **Removed:** 24 legacy scripts from `scripts/` ‚Äî `install.ps1`, `setup.sh`, `setup.ps1`, `pre-commit.js`, `pre-commit.ps1`, `pre-commit-lint.sh`, `ai-protection.js/.ps1/.sh`, `ai-session.sh`, `session-init.sh`, `context-diff.sh`, `estimate-tokens.sh`, `token-log.sh`, `token-status.sh/.ps1`, `migrate-to-hub.sh`, `cleanup-root.sh`, `check-links.sh`, `seo-check.sh`, `setup-lint.sh`, `validate-setup.sh`, `validate-structure.sh`, `verify-templates.sh`
- **Removed:** 3 legacy mirrors from `npm-templates/scripts/` ‚Äî `pre-commit-lint.sh`, `setup-lint.sh`, `token-status.sh`
- **Removed:** `npm-templates/.ai/token-limits.json` + `npm-templates/.ai/session-log.json` ‚Äî runtime files must never be in distributable
- **Removed:** `QUICK_CONTEXT.md` ‚Äî outdated, fully superseded by `PROJECT_CONTEXT_MAP.md` + `PROJECT_IDEOLOGY.md`
- **Changed:** `config.json` (both dev + npm-templates) ‚Äî removed dead `token_budget` block, removed `modules: []`, bumped `config_version: "2.1"` ‚Üí `"2.2"`
- **Active scripts remaining:** `install.sh`, `pre-commit`, `post-push.sh`, `sync-rules.sh`

### Round 4: Ideology + Arbiter (feat(round-4) commit)

- **New:** `PROJECT_IDEOLOGY.md` ‚Äî soul document (WHY/WHO/PRODUCT/PRINCIPLES/ANTI-GOALS/DECISIONS/VISION/MARKET CONTEXT)
- **New:** `npm-templates/PROJECT_IDEOLOGY.md` ‚Äî user template with placeholders, generated by `/ctx` skill
- **Updated:** `bin/cli.js` + `scripts/install.sh` ‚Äî now copy `PROJECT_IDEOLOGY.md` during install + added to Next Steps
- **Updated:** `.claude/commands/arbiter.md` (√ó2 dual) ‚Äî added DECISIONS check, cross-proposal conflict detection, uncommitted work collision check
- **Updated:** `.claude/commands/ctx.md` (√ó2 dual) ‚Äî added PRODUCT section to Case A ideology template
- **Updated:** `PROJECT_CONTEXT_MAP.md` ‚Äî full fresh scan (Phases 1-5)

### Round 3 (Tasks 10, 12, 13) ‚Äî 2026-02-23

- **feat(task-13):** Skill triangle enhancement ‚Äî ideology capture + mandatory WebSearch in `/sculptor` + Think Harder protocol in `/arbiter`
- **feat(task-10):** Installer wizard simplified: 8 questions ‚Üí 3 (provider ‚Üí plan ‚Üí market)
- **feat(task-12):** Cursor ‚â•0.45 support ‚Äî added `.cursor/rules/ai-workflow.mdc` with YAML frontmatter (both dev + npm-templates)

### Round 2 (Task 12) ‚Äî 2026-02-23

- **feat(task-12):** Cursor migration to `.mdc` format ‚Äî proper YAML frontmatter, `alwaysApply: true`, compatible with Cursor Rule Manager

---

## [9.1.1] - 2026-02-22

### üÜï Added - Session Memory Anchor (Task 7)

Universal session anchor for new-day detection ‚Äî works across all AI tools:
- **New:** `scripts/post-push.sh` ‚Äî auto-updates `## üìç Last Push` section in `PROJECT_CONTEXT_MAP.md` after every `git push`
- **New:** `npm-templates/scripts/post-push.sh` ‚Äî distributed to users via installer
- **Updated:** `.claude/CLAUDE.md` ‚Äî Step 2.2: reads anchor at session start, compares date with today
- **Updated:** `AGENTS.md` ‚Äî same anchor instruction for Cursor and other AI tools
- **Updated:** `bin/cli.js` ‚Äî auto-installs `.git/hooks/post-push` during setup (no user question)
- **Updated:** `PROJECT_CONTEXT_MAP.md` ‚Äî `## üìç Last Push` section added as manual seed
- **Architecture:** `git push ‚Üí post-push.sh ‚Üí updates map ‚Üí AI reads date ‚Üí new day detection`
- **Principle:** "New day = fresh limits" is the anchor. No API needed. Date comparison only.

### üÜï Added - /arbiter Skill: Execution Planner (Task 8)

Third vertex of the skill triangle `/ctx ‚Üí /sculptor ‚Üí /arbiter`:
- **New:** `.claude/commands/arbiter.md` ‚Äî execution planner & safety gatekeeper
- **New:** `npm-templates/.claude/commands/` ‚Äî all 3 skills now distributed to users via installer
- **Fixed:** `/ctx` and `/sculptor` were missing from `npm-templates` ‚Äî now included
- **Updated:** `bin/cli.js` ‚Äî installer copies all 3 skills to `.claude/commands/` during setup
- **Arbiter output:** `ARBITER_REPORT.md` with ordered execution queue + risk register
- **Verdicts:** üü¢ Ready | üü° Needs review | üî¥ Blocked
- **Pipeline complete:** `/ctx` ‚Üí `/sculptor` ‚Üí `/arbiter` ‚Üí ROADMAP update

### üîß Changed - Token System Redesign (Task 6)

Replaced 840-line `TOKEN_PRESETS` inline constant with clean `presets.json` v1.0:
- **New:** `npm-templates/.ai/presets.json` ‚Äî single source of truth for tool/plan configs
- **Removed:** `TOKEN_PRESETS` hardcoded object from `bin/cli.js`
- **Removed:** `MODEL_1` / `MODEL_3` architecture model classification
- **Removed:** Fake daily/monthly limits (all were either invented or unknown)
- **New:** `token-limits.json` v4.0 ‚Äî session-based, honest nulls for unknown limits
- **New:** `config.json` v2.2 ‚Äî no USD pricing, no fake `token_budget` block
- **Principle:** session_limit = public context window. daily_limit = null (not published). No prices.
- **Providers in presets.json:** anthropic, google, cursor, openai, deepseek, groq, mistral, perplexity

### üîß Changed - CLI Wizard Modernized (Task 5)

Replaced `inquirer@8` (legacy) with `@clack/prompts` (lightweight, 2025 standard):
- Cleaner UX: spinner, intro/outro, cancel-safe prompts
- Removed 44 transitive packages, added 4
- Fixed naming collision bug: `updateGitignore` variable now `shouldUpdateGitignore` in `main()`
- Removed dead code: `teamSize` + `tokenPriority` questions (no longer needed after Task 4)
- `node` engine requirement: `>=14.0.0` ‚Üí `>=16.0.0`

### üóëÔ∏è Removed - Context Presets Simplified (Task 4)

Removed `standard` and `enterprise` context presets. Framework now provides two clear choices:
- **`minimal`** (~10k) ‚Äî startups, MVP, simple projects
- **`ukraine-full`** (~18k) ‚Äî Ukrainian market, full compliance

**Rationale:** `minimal` and `ukraine-full` cover 95%+ of real use cases. Fewer choices = better UX.

**Files removed:**
- `.ai/contexts/standard.context.md`
- `.ai/contexts/enterprise.context.md`
- `npm-templates/.ai/contexts/standard.context.md`
- `npm-templates/.ai/contexts/enterprise.context.md`

**Files updated:** CLAUDE.md (√ó2), AGENTS.md (√ó2), registry.json, config.example.json, README.md, bin/cli.js

---

## [9.1.0] - 2026-02-08

### üöÄ Changed - Token Optimization + .ai/ Hub Restructure

**Major Release:** 30-40% overall token savings through intelligent management and optimization.

**Philosophy:** Evolution over revolution. Quality > Speed. No overengineering. Preserve all protections.

**Context Size Reductions:**
- **Minimal:** 13k ‚Üí 10k (-23%, -3k tokens)
- **Ukraine-full:** 25k ‚Üí 18k (-28%, -7k tokens)

**How we achieved it:**
- ‚úÖ Removed repetition
- ‚úÖ Concise writing (active voice, shorter sentences)
- ‚úÖ Tables instead of verbose lists
- ‚úÖ Smarter organization
- ‚úÖ **Zero feature loss** (all protections intact)

### üÜï Added - Enhanced Compression System

**Multi-Level Compression (AI-ENFORCEMENT.md v2.0):**
- **Level 1 (Light):** 50-70% tokens ‚Üí saves 40%
- **Level 2 (Aggressive):** 70-90% tokens ‚Üí saves 60%
- **Level 3 (Maximum):** 90%+ tokens ‚Üí saves 70%

**5 Automatic Triggers:**
1. After `git push origin <branch>` (ALWAYS)
2. After session reaches 50% tokens (100k/200k)
3. After completing major task (user confirms)
4. Before starting new major task
5. After 15+ messages in current thread

**Auto-Level Selection:**
- Session 50-70% ‚Üí Level 1 (Light)
- Session 70-90% ‚Üí Level 2 (Aggressive)
- Session 90%+ ‚Üí Level 3 (Maximum)

**Proactive Suggestions:**
- At 25% (50k): Suggest compression after current task
- At 50% (100k): Recommend compression now
- At 70% (140k): Auto-switch to brief mode + warning
- At 90% (180k): Critical warning + finalize recommendation

### üÜï Added - Session Management Best Practices

**New Guide:** `.ai/SESSION_MANAGEMENT.md` (~405 lines)

**Key Insights:**
- Session restart costs 18-25k tokens
- 50% fewer restarts = 35-50k tokens/day saved
- Continue vs restart decision guide
- Platform-specific tips (VSCode, Cursor, Windsurf)

**When to CONTINUE (not restart):**
- ‚úÖ Minor code changes, bug fixes
- ‚úÖ Working through roadmap stages
- ‚úÖ After using `//COMPACT`
- ‚úÖ Tokens <90% and task ongoing

**When to RESTART:**
- üîÑ Pushed to main (major milestone)
- üîÑ Tokens >90% (budget critical)
- üîÑ Switching to different feature
- üîÑ Next day, different context

**Expected savings:** 50% reduction in unnecessary restarts

### üÜï Added - Token Dashboard & Utilities

**Token Status Dashboard:**
- `scripts/token-status.sh` - Bash version (Linux, macOS, Git Bash)
- `scripts/token-status.ps1` - PowerShell version (Windows)
- Shows: daily/monthly usage, zone indicators (üü¢/üü°/üü†/üî¥), projections, recommendations
- Context optimization tips included

**Token Estimation Utility:**
- `scripts/estimate-tokens.sh` - Estimates tokens from files/stdin
- Uses ~4 chars = 1 token rule (Claude tokenizer average)
- Verbose mode with detailed breakdown
- Context comparison (% of session limit)

**NPM Scripts:**
```json
{
  "scripts": {
    "token-status": "bash scripts/token-status.sh || pwsh scripts/token-status.ps1",
    "estimate-tokens": "bash scripts/estimate-tokens.sh",
    "providers": "cat .ai/docs/provider-comparison.md"
  }
}
```

### üÜï Added - Comprehensive Provider Database

**File:** `.ai/token-limits.json` updated with complete provider data

**Coverage:** 9 providers, 25+ plans with full details
- **Anthropic (Claude):** API + claude.ai (Free/Pro/Team)
- **Google (Gemini):** API + Gemini (Free/Advanced)
- **Cursor:** Free/Pro/Business
- **GitHub Copilot:** Individual/Business/Enterprise
- **Mistral:** API (Large/Medium/Small)
- **Groq:** Free tier
- **DeepSeek:** API (ultra-cheap)
- **Perplexity:** Free/Pro
- **Windsurf (Codeium):** Free/Enterprise

**Data includes:**
- Monthly/daily/session limits
- Pricing ($/month, per 1M tokens input/output)
- Rate limiting type (hard/soft/fair use)
- Notes, recommendations, sources
- Last updated: 2026-02-07

**New Guide:** `.ai/docs/provider-comparison.md` (~900 lines)
- Quick comparison table
- Recommendations by use case
- Cost calculator
- Decision matrix
- Migration tips

### üÜï Added - Smart Context Selection

**Enhanced installers with recommendation engine:**
- `bin/cli.js` - Interactive questionnaire
- `scripts/install.sh` - Bash version
- `scripts/install.ps1` - PowerShell version

**Features:**
- 3 questions: team size, market (Ukrainian/International), token priority
- Personalized recommendations based on answers
- Visual comparison table during installation
- Manual override option available

**Example:**
```
Team size: 1-2 developers
Market: Ukrainian
Token priority: High

‚Üí Recommended: ukraine-full (~18k tokens, 9% of daily)
Reasoning:
  ‚Ä¢ Ukrainian market needs full compliance features
  ‚Ä¢ Token efficiency prioritized
```

### üìä Impact Analysis

**Typical session savings (ukraine-full context):**
```
v9.0:
- Session start: 25k tokens
- Work (15 messages): 75k tokens
- Total: 100k tokens

v9.1:
- Session start: 18k tokens (-7k)
- Work with better compression: 60k tokens (-15k)
- Total: 78k tokens (-22k, -22% savings)
```

**Better practices ‚Üí fewer restarts:**
```
v9.0: 4 restarts/day √ó 25k = 100k overhead
v9.1: 2 restarts/day √ó 18k = 36k overhead
Savings: 64k tokens/day from session management alone
```

**Combined savings: 30-40% overall token usage**

### üîß Changed

**Files Updated:**
- `.ai/AI-ENFORCEMENT.md` ‚Üí v2.0 (Enhanced Compression)
- `.ai/token-limits.json` ‚Üí Comprehensive provider database
- `.ai/contexts/minimal.context.md` ‚Üí Optimized (-23%)
- `.ai/contexts/ukraine-full.context.md` ‚Üí Optimized (-28%)
- `.claude/CLAUDE.md` ‚Üí Updated with v9.1 token counts
- `README.md` ‚Üí Added v9.1 features section
- `package.json` ‚Üí Added npm scripts for token management

**Files Created:**
- `.ai/SESSION_MANAGEMENT.md` - Session best practices guide
- `.ai/docs/provider-comparison.md` - Comprehensive provider guide
- `scripts/token-status.sh` - Token dashboard (bash)
- `scripts/token-status.ps1` - Token dashboard (PowerShell)
- `scripts/estimate-tokens.sh` - Token estimation utility

### ‚úÖ Preserved - Zero Breaking Changes

**ALL systems intact:**
- ‚úÖ All 6 protection layers (client/user/business/AI)
- ‚úÖ Universal AI tool support (Claude/Cursor/Windsurf/Continue)
- ‚úÖ Cross-platform compatibility (Linux/macOS/Windows)
- ‚úÖ Security systems (pre-commit, AI Protection, PII detection)
- ‚úÖ Backward compatible (existing users unaffected)

**Migration:** Automatic - contexts updated in place. No user action required.

### üéØ Philosophy

**v9.1 Principles:**
- Evolution, not revolution
- Quality > Speed
- No overengineering (rejected Smart Contexts v10.0 approach)
- Focus on real pain points, not theoretical optimization
- Aligned with industry best practices 2026

**Made in Ukraine üá∫üá¶**

---

## [9.0.0] - 2026-02-07

### üõ°Ô∏è Added - AI Protection System

**New Major Feature:** Comprehensive AI protection against prompt injection and PII leaks.

- **Prompt Injection Detection**
  - 10 critical attack patterns (system override, jailbreak, data exfiltration, etc.)
  - Context-aware whitelist (docs, tests, examples auto-excluded)
  - Intelligent false positive reduction
  - `.ai/prompt-injection-patterns.json` - Full pattern library

- **PII Protection (GDPR-Ready)**
  - Auto-detects: emails, phones, IPs, API keys, Ukrainian IPN/passports
  - Auto-redaction with backup
  - Scans `.ai/` directory and AI logs
  - `.ai/pii-patterns.json` - Ukrainian market focus

- **Directory Protection**
  - Validates `.ai/` gitignore configuration
  - Prevents `ai-logs/` commits (full conversation logs)
  - Protects `.claude/cache/` and sensitive files

- **Cross-Platform Scripts**
  - `scripts/ai-protection.sh` (Linux, macOS, Git Bash)
  - `scripts/ai-protection.ps1` (Windows PowerShell)
  - `scripts/ai-protection.js` (Node.js, universal)

- **Integration**
  - Auto-runs in pre-commit hook (after Tier 1/2/3 checks)
  - Fail-closed by default (secure)
  - Backward compatible (graceful fallback if missing)

- **Configuration**
  - `.ai/ai-protection-policy.json` - Master config
  - 3 modes: strict, balanced (default), permissive
  - Bypass: `// ai-protection-ignore` or `.ai-protection-ignore` file

- **Documentation**
  - `.ai/THREAT_MODEL.md` - Security analysis
  - `.ai/DISCLAIMERS.md` - Legal framework

### üîß Fixed

- **Tier 3 Whitelist:** Added AI Protection pattern files to prevent false positives:
  - `.ai/ai-protection-policy.json`
  - `.ai/prompt-injection-patterns.json`
  - `.ai/pii-patterns.json`

### üöÄ Changed

- **Installers Updated (v9.0)**
  - `scripts/install.sh` - Added AI Protection info
  - `scripts/install.ps1` - Added AI Protection info
  - `bin/cli.js` - Updated to v9.0 with new features

- **Pre-commit Hook:** Now includes AI Protection as 4th layer (after Tier 1/2/3)

### üìö Technical Details

**Philosophy:** "Silent Guardian" - Protect without blocking productivity

**Approach:** Defense in Depth + Fail-Closed + Context-Aware

**Supported AI Assistants:**
- Claude Code, Cursor, Windsurf, Aider, Continue.dev
- GitHub Copilot, ChatGPT, Gemini Code Assist
- All generic AI coding tools

**Performance:** +1-5 seconds to pre-commit (negligible impact)

**Ukrainian Market Focus:**
- GDPR compliance tools (not certification)
- Ukrainian PII patterns (IPN, passport, IBAN)
- Zero russian services policy (inherited from v8.3)

---

## [8.3.0] - 2026-02-04

### Added
- Universal cross-platform compatibility
- Enhanced security with 3-tier protection
- Russian tracker detection (Ukrainian market policy)

---

## [8.1.0] - 2026-02-03

### Added
- Modular context system (minimal, ukraine-full)
- Token efficiency (40-70% savings for international users)
- Smart context selection wizard

---

## [8.0.0] - 2026-01-28

### Added
- Complete framework rewrite
- Token management v2.0
- Roadmap-driven development workflow
- Multi-language support

---

## Earlier Versions

See git history for versions < 8.0

---

**Made in Ukraine üá∫üá¶**

#### Phase 7: .ai/ Hub Restructure (2026-02-08)

**BREAKING CHANGE:** File locations restructured for cleaner repository.

**Moved Files:**
- Documentation ‚Üí `.ai/docs/` (7 files: quickstart, cheatsheet, token-usage, etc.)
- Rules ‚Üí `.ai/rules/` (core.md, product.md)  
- Root cleaned: Only AGENTS.md remains as entry point

**Updated:**
- AGENTS.md: Rewritten as navigation hub
- All 4 contexts: Updated paths
- All installers: bin/cli.js ‚úì, install.sh ‚ö†Ô∏è deprecated, install.ps1 ‚ö†Ô∏è deprecated
- npm-templates/: Reorganized to match new structure

**New:**
- `scripts/migrate-to-hub.sh`: Migration script for existing users
- Migration guide in documentation

#### Phase 7.1: Code Quality Lint Hook (2026-02-08)

**Added optional pre-commit lint check (warnings only, non-blocking):**
- Auto-detects: JS/TS, Python, Go, Shell, Markdown
- Shows warnings but never blocks commits
- Skip via: `AI_SKIP_LINT=1 git commit`

**New Files:**
- `scripts/pre-commit-lint.sh`: Lint hook with auto-detection
- `scripts/setup-lint.sh`: Auto-install linters
- `.ai/docs/code-quality.md`: Complete documentation
- AI Protocol #5 in AI-ENFORCEMENT.md

#### Phase 7.2: Critical Fixes (2026-02-08)

**Fixed critical issues from Phase 7 audit:**
- ‚úÖ Created `.cursorrules` and `.windsurfrules` for IDE integration
- ‚úÖ Updated README.md links to new file locations  
- ‚úÖ Updated .gitignore for auto-generated IDE files
- ‚ö†Ô∏è Added deprecation warnings to install.sh/install.ps1 (use bin/cli.js instead)

**IDE Support:**
- Cursor IDE: .cursorrules template
- Windsurf IDE: .windsurfrules template
- Claude Code: .claude/CLAUDE.md (existing)
- All: AGENTS.md universal support

#### Phase 7.3: Installer & Script Fixes (2026-02-08)

**CRITICAL: Complete overhaul of all installers and scripts for Phase 7 compatibility.**

**Fixed:** `scripts/sync-rules.sh` (CRITICAL bug)
- ‚ùå **Before:** Overwrote AGENTS.md and .claude/CLAUDE.md with context content
- ‚úÖ **After:** Preserves AGENTS.md (navigation hub) and .claude/CLAUDE.md (custom wrapper)
- ‚úÖ Only regenerates IDE-specific files: .cursorrules, .windsurfrules, .continuerules
- ‚úÖ Updated header documentation explaining the change

**Fixed:** `bin/cli.js` (NPM installer - 5 improvements)
- ‚úÖ Removed AGENTS.md from auto-generation (now static template)
- ‚úÖ Removed .claude/CLAUDE.md from auto-generation (now static template)
- ‚úÖ Added .claude/CLAUDE.md copy from npm-templates/.claude/
- ‚úÖ Added code-quality.md copy to .ai/docs/
- ‚úÖ Fixed Cursor/Windsurf detection logic (always generate templates)
- ‚úÖ Updated all version numbers to v9.1

**Fixed:** `scripts/install.sh` (Bash installer - 7 improvements)
- ‚úÖ **COMPLETE REWRITE:** Now copies from new Phase 7 structure
- ‚úÖ Copies all docs from `.ai/docs/` (7 files including code-quality.md)
- ‚úÖ Copies rules from `.ai/rules/` (core.md, product.md)
- ‚úÖ Copies AGENTS.md as static file (no generation)
- ‚úÖ Removed AGENTS.md and .claude/CLAUDE.md from generation logic
- ‚úÖ Only generates IDE-specific: .cursorrules, .windsurfrules, .continuerules
- ‚úÖ Updated user instructions with new paths (.ai/docs/quickstart.md)
- ‚úÖ Updated all version numbers to v9.1

**Fixed:** `scripts/install.ps1` (PowerShell installer - 6 improvements)
- ‚úÖ **COMPLETE REWRITE:** Identical fixes to install.sh for Windows
- ‚úÖ Copies all docs from `.ai\docs\` (PowerShell paths)
- ‚úÖ Copies rules from `.ai\rules\`
- ‚úÖ Copies AGENTS.md as static file
- ‚úÖ Removed AGENTS.md and .claude/CLAUDE.md from generation
- ‚úÖ Updated user instructions and version numbers to v9.1

**Impact:**
- ‚úÖ All installers now fully compatible with Phase 7 structure
- ‚úÖ AGENTS.md will never be overwritten by sync-rules.sh again
- ‚úÖ .claude/CLAUDE.md preserved as custom wrapper
- ‚úÖ IDE templates (.cursorrules, .windsurfrules) correctly generated from context
- ‚úÖ Users can safely run `npm run sync-rules` without losing navigation hub

**Testing:** All critical components verified for Phase 7 compatibility

