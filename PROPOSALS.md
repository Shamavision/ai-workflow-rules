# PROPOSALS — Architectural Surgery Report
> Generated by `/sculptor` on 2026-02-21
> Based on: PROJECT_CONTEXT_MAP.md (2026-02-21, fresh)
> Git: last commit `798fac4` (feat phase-15+16)

---

## Summary

The framework has a strong core concept (Ukrainian-first AI workflow rules, honest token tracking, security guards), but is suffering from **structural coupling** — the 10-file sync requirement creates a hidden maintenance tax on every change. The second critical issue is **dual source of truth** for token data (token-limits.json ↔ bin/cli.js TOKEN_PRESETS). These two problems should be resolved before adding any new features.

**Proposals:** 9 total (P1: 3 critical | P2: 3 important | P3: 3 optional)

---

## P1 Proposals — Critical (address first)

### P1.1: RESTRUCTURE — Single Source for Rule Content
**Why:** Currently 10 rule files (5 pairs: CLAUDE.md, .cursorrules, .windsurfrules, AGENTS.md, AI-ENFORCEMENT.md) are all maintained MANUALLY. No master template generates them. Adding one new rule requires editing 10 files. This is why the framework has been accumulating sync errors and incomplete updates — the architecture makes correctness physically difficult.

**What exactly:**
1. Create `.ai/rules/master.md` — single source containing all AI behavior rules
2. Adapt `scripts/sync-rules.sh` to GENERATE rule files from master (not just copy)
3. Each target format (claude/cursor/windsurf/agents) gets a thin adapter template
4. Result: Edit in ONE place → script propagates to all 10

**Impact:** High — eliminates the #1 maintenance burden
**Effort:** Large (~1 week)
**Market context:** Every mature configuration framework has a single source + generation step (dotenv, eslint shared configs, etc.)
**ROADMAP candidate:** Yes → "Task 2: Master Rule Source + Code Generation"

---

### P1.2: MERGE — Eliminate TOKEN_PRESETS duplication (bin/cli.js ↔ token-limits.json)
**Why:** `bin/cli.js` maintains its own `TOKEN_PRESETS` object (lines 15-57) that duplicates data from `.ai/token-limits.json`. These have already diverged (noted in technical debt). Two sources of truth for the same data = guaranteed drift over time.

**What exactly:**
1. Extract a slim `npm-templates/.ai/presets.json` (only the data needed by installer: provider + plan → daily/monthly limits)
2. `bin/cli.js` reads from this JSON at runtime instead of hardcoding
3. `token-limits.json` keeps its full PRESETS section for AI reference
4. Sync becomes: one update to `presets.json` reaches both cli + token-limits reference

**Impact:** High — removes technical debt that silently corrupts installer behavior
**Effort:** Medium (~4-6h)
**Market context:** DRY (Don't Repeat Yourself) is foundational. Two hardcoded copies of the same config table is a known anti-pattern.
**ROADMAP candidate:** Yes → "Task 3: Deduplicate TOKEN_PRESETS"

---

### P1.3: REPLACE — Migrate from inquirer@8 to modern CLI library
**Why:** `inquirer@^8` is a legacy major version. The library underwent a complete API rewrite in v9 (ESM-only, different interface). v8 is no longer receiving new features and security patches may slow. This creates real risk for the installer — the primary user-facing tool.

**What exactly:**
- Option A: Pin to `inquirer@8.2.6` (specific version, not range) — buys time, no migration
- Option B: Migrate to `@clack/prompts` (lightweight, modern, actively maintained, ~8x smaller bundle)
- **Recommend Option B** — @clack/prompts has cleaner API and is the 2025 community standard for CLI prompts

**Impact:** High — protects the installer from future breakage
**Effort:** Medium (~1 day for migration, well-worth it)
**Market context:** @clack/prompts is used by create-vite, astro CLI, and other modern tools (2024-2025). `[VERIFY]` before migration — check breaking changes.
**ROADMAP candidate:** Yes → "Task 4: Migrate CLI to @clack/prompts"

---

## P2 Proposals — Important

### ~~P2.1: REMOVE — Reduce from 4 context presets to 2~~ ✅ DONE (2026-02-22, Task 4)
**Result:** Removed `standard` and `enterprise` presets. Now: `minimal` (10k) + `ukraine-full` (18k).
**Impact:** 2 files deleted (×2 pairs = 4 total), 12 files updated, simpler UX.

---

### P2.2: RESTRUCTURE — Split token-limits.json responsibilities
**Why:** 840-line file does 4 unrelated things: user config + all provider PRESETS (reference data) + session tracking + optimization stats. This is a SRP violation that makes the file untestable and difficult to read. Its size alone (840 lines, ~15k tokens) forces us to warn "NEVER read whole file" — that's a sign of a broken design.

**What exactly:**
1. `config.json` → user config only (already mostly there, small)
2. `presets.json` → provider pricing data (NEW, slim version for installer)
3. `session-log.json` → session tracking (already separate ✅)
4. `token-limits.json` → KEEP as comprehensive reference doc (AI reads, users can consult)
   But acknowledge it's a REFERENCE MANUAL, not an active config

**Impact:** Medium — removes the "never read this file" anti-pattern
**Effort:** Small (~2-3h)
**Market context:** Separation of concerns. Config ≠ reference data ≠ runtime tracking
**ROADMAP candidate:** Yes → part of "Task 3: Deduplicate TOKEN_PRESETS"

---

### P2.3: REMOVE — Clean dead directories (public/, audits/, examples/ status)
**Why:** Git log shows `chore(cleanup): remove examples/ and public/ from public repo` (commit ad332c8) — but `public/` still appears in Glob results. `audits/` contains completed audit docs (v9.1.1) that serve no active purpose. These are dead weight.

**What exactly:**
1. `public/` — verify if truly removed from npm package; if so, either delete from dev or move to `.private/`
2. `audits/` — move to `ai-logs/audits/` (archive, not project root clutter)
3. `examples/` — verify current status (removed from npm but kept in dev?); if dev-only, move to `ai-logs/examples/` or delete
4. Create `.npmignore` or verify `package.json "files"` excludes these correctly

**Impact:** Medium — cleaner project root, less confusion about what's active
**Effort:** Small (~1h)
**Market context:** Project root hygiene matters for open-source credibility. Too many directories = unclear project structure
**ROADMAP candidate:** No → do it now as cleanup

---

## P3 Proposals — Optional / Nice to Have

### P3.1: RESTRUCTURE — /ctx output: add "staleness score" + next-review date
**Why:** The hook currently shows "N days old" warning after 7 days. But 7 days is arbitrary. A project with 50 commits/week goes stale in hours. One with 1 commit/month is fine after 30 days.

**What exactly:**
Add to PROJECT_CONTEXT_MAP.md header:
```
**Context valid until:** [date, calculated as last_updated + estimated_activity_rate]
**Activity since last /ctx:** X commits (run /ctx update if >10)
```
The hook reads this date instead of hardcoded 7-day rule.

**Impact:** Low-Medium — smarter staleness detection
**Effort:** Small (~1h change to /ctx + hook)
**ROADMAP candidate:** No → enhancement, not critical

---

### P3.2: REMOVE/MERGE — VISUAL_GUIDE.md + QUICK_CONTEXT.md audit
**Why:** VISUAL_GUIDE.md existence is unclear — is it referenced anywhere? Is it maintained? QUICK_CONTEXT.md serves as "compressed session context" — similar purpose to minimal.context.md.

**What exactly:**
1. Check if VISUAL_GUIDE.md is linked from README or any docs → if not, delete or archive
2. Consider: QUICK_CONTEXT.md → becomes the exported "minimal" preset template (merge into one)

**Impact:** Low — minor cleanup
**Effort:** Small (~30 min)
**ROADMAP candidate:** No → cleanup task

---

### P3.3: CONSIDER — Ukrainian differentiator as explicit brand pillar
**Why:** The Ukrainian market positioning is a genuine competitive advantage. But it lives mostly in rules and comments. No other AI workflow framework explicitly targets Ukrainian developers. This should be MORE visible, not less.

**What exactly:**
- Lead README.md with "Made in Ukraine" positioning upfront (not just footer)
- Explicit section: "Why Ukrainian developers trust this framework" (GDPR, no .ru services, Ukrainian-first)
- Consider: `//CHECK:LANG` command as a named product feature, not just an internal command

**Impact:** Medium (brand/market) — strengthens differentiation
**Effort:** Small (documentation + positioning only)
**Market context:** Ukrainian tech ecosystem is growing globally post-2022. Ukrainian-built tools have credibility in EU markets.
**ROADMAP candidate:** Yes → "Task 6: Ukrainian Brand Pillar"

---

## What NOT to Change (Sculptor's Preservation List)

These elements are CORRECT as-is. Do not touch:

| What | Why to keep |
|------|-------------|
| 3-Layer Mental Model (Context/Rate/Billing) | Honest, elegant, market-differentiating |
| session-log.json self-reporting | Smart solution to UNKNOWN limits |
| Security guards (forbidden-trackers, pre-commit hook) | Core value, unique feature |
| Ukrainian market focus | Moat, differentiator — strengthen, not weaken |
| `.ai/` directory structure | Clean, logical, well-organized |
| Quality > Speed principle | Philosophical foundation — never compromise |
| /ctx + /sculptor pipeline | Just built, already excellent architecture |

---

## Next Steps

1. **Review P1.1 (Master Rule Source)** — this is the most impactful structural change. Discuss approach before starting.
2. **P2.3 cleanup** — can be done immediately, low risk (30 min)
3. **P1.2 deduplication** — medium effort, high value, do before next release
4. **For each P1 approved:** add as Task to ROADMAP with scope estimate

Run `/ctx update` after any structural changes to refresh the context map.
