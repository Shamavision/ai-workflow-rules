# PROPOSALS ‚Äî Architectural Surgery Report
> Generated by `/sculptor` on 2026-02-22
> Based on: PROJECT_CONTEXT_MAP.md (2026-02-22, fresh)
> Git: last commit `7b1b5fd` (feat tasks-4-8) + Task 7 uncommitted
> Status: Fresh context ‚úÖ

---

## Summary

After Tasks 1-8, the framework core is clean and cohesive. The three remaining structural issues are: (1) a broken bash installer that gives Linux/Mac users a divergent/broken experience, (2) dead weight files that load into AI context every session (token-limits.json 840 lines, CLAUDE.md redundant sections), and (3) a missing sync guard that lets dev ‚Üî npm-templates drift silently. These are solvable in small, focused tasks.

**Proposals:** 8 total (P1: 2 critical | P2: 3 important | P3: 3 optional)

---

## P1 Proposals ‚Äî Critical (address first)

### P1.1: REMOVE ‚Äî `.ai/token-limits.json` (840-line AI trap)
**Why:** After Task 6, `presets.json` replaced this file as source of truth. The 840-line file in the dev project is a historical artifact. AI is explicitly forbidden to read it whole (written in 3 places: PROJECT_CONTEXT_MAP.md, CLAUDE.md, memory). It exists "for reference" ‚Äî but no one reads it and it can't be opened safely. A file you can't safely read is dead weight.
**What exactly:** Delete `.ai/token-limits.json` from dev project. Add `token-limits.json` to `.gitignore` note as user-generated (it's recreated by installer). Verify npm-templates does NOT contain it (it shouldn't ‚Äî check).
**Impact:** High ‚Äî removes a known AI trap, cleans dev project
**Effort:** Small ‚âà 30 min
**Market context:** Dead files create maintenance confusion. YAGNI.
**Breaking:** üü¢ Non-breaking ‚Äî users get a fresh token-limits.json at install time. Dev project version was never distributed.
**ROADMAP candidate:** Yes ‚Üí "Task 9: Clean dead weight files"

---

### P1.2: RESTRUCTURE ‚Äî `install.sh` Wizard Redesign (Wizard Redesign Backlog)
**Why:** The bash installer is actively broken for users on Linux/Mac. It shows 4 context presets instead of 2 (standard/enterprise were removed in Task 4), has dead code (teamSize, tokenPriority), and diverges from the npx wizard. Every Linux/Mac user who chooses bash install gets a broken experience. This is user-facing harm, not technical debt.
**What exactly:** Implement the decisions from Wizard Redesign Backlog (documented in ROADMAP.md):
- Remove teamSize + tokenPriority questions
- Fix context selection to show only minimal + ukraine-full
- Auto-install pre-commit hooks (no question)
- Auto-append .gitignore (no question)
- Make install.sh logically identical to bin/cli.js wizard
**Impact:** High ‚Äî all Linux/Mac users benefit immediately
**Effort:** Medium ‚âà 1-2d
**Market context:** Ukrainian developer market has significant Linux/Mac presence. Broken installer = bad first impression.
**Breaking:** üü¢ Non-breaking ‚Äî users re-running installer get correct experience
**ROADMAP candidate:** Yes ‚Üí "Task 9 (alt): Wizard Redesign ‚Äî unify NPX + Bash"

---

## P2 Proposals ‚Äî Important

### P2.1: REMOVE ‚Äî CLAUDE.md redundant sections (per-session token waste)
**Why:** CLAUDE.md has two sections that load into context EVERY session but are redundant:
- "üìÅ File Structure Reference" ‚Äî duplicates PROJECT_CONTEXT_MAP.md (which is already compact and regularly updated)
- "üÜï What's New in v9.1" ‚Äî changelog information already in CHANGELOG.md
Combined these are ~2-3k tokens loaded into every single session, forever. With the new `/ctx update` workflow, PROJECT_CONTEXT_MAP.md is the authoritative structure reference.
**What exactly:** Remove "File Structure Reference" section from CLAUDE.md (both dev + npm-templates). Replace with 1-line pointer: "‚Üí See `PROJECT_CONTEXT_MAP.md` for current structure." Remove "What's New in v9.1" section entirely.
**Impact:** Medium ‚Äî saves ~2-3k tokens per session startup permanently
**Effort:** Small ‚âà 30 min
**Market context:** Leaner context = faster, cheaper sessions. Consistent with "Less is more" philosophy.
**Breaking:** üü¢ Non-breaking ‚Äî informational sections only
**ROADMAP candidate:** Yes ‚Üí "Task 10: Slim CLAUDE.md ‚Äî remove stale sections"

---

### P2.2: ADD ‚Äî Dual-structure sync validation in pre-commit hook
**Why:** Currently nothing prevents dev ‚Üî npm-templates from drifting silently. The pre-commit hook checks secrets but NOT sync. If a developer modifies `.claude/CLAUDE.md` and forgets `npm-templates/.claude/CLAUDE.md`, the bug ships silently. This has happened (we verified during earlier tasks that npm-templates was missing ctx.md and sculptor.md).
**What exactly:** Add to `scripts/pre-commit`: if any file in the 3 rule pairs is staged, check that its npm-templates counterpart is also staged. If not ‚Äî warn (not block) with: "‚ö†Ô∏è Sync warning: X was modified but npm-templates/X was not staged."
**Impact:** Medium ‚Äî prevents silent distribution bugs
**Effort:** Small ‚âà 1h (add ~20 lines to pre-commit)
**Market context:** Distribution quality gates are standard in published npm packages.
**Breaking:** üü¢ Non-breaking ‚Äî warning only, doesn't block commit
**ROADMAP candidate:** Yes ‚Üí "Task 10 (alt): Pre-commit sync guard"

---

### P2.3: VERIFY ‚Äî Cursor `.cursorrules` deprecation ‚Üí `.cursor/rules/` migration
**Why:** [ESTIMATE ‚Äî must verify] Based on patterns up to Aug 2025, Cursor was migrating from `.cursorrules` (single file) to `.cursor/rules/` directory with `.mdc` files. If this migration is complete, users on new Cursor versions may not receive any rules from `.cursorrules`. This would silently break the Cursor integration.
**What exactly:**
1. User should verify: open Cursor, check if `.cursorrules` is still supported in their version
2. If deprecated: add `.cursor/rules/ai-workflow.mdc` as a new file (wrapping `.cursorrules` content)
3. Update installer to copy/create `.cursor/rules/ai-workflow.mdc`
4. Keep `.cursorrules` for backward compatibility for now
**Impact:** High IF `.cursorrules` is deprecated ‚Äî all Cursor users silently get no rules
**Effort:** Small ‚âà 1h (if confirmed needed)
**Market context:** Cursor is heavily used in Ukrainian dev market. Silent rule failure = framework value lost.
**Breaking:** üü¢ Non-breaking ‚Äî additive (keep old + add new)
**ROADMAP candidate:** Yes ‚Üí "Task 11: Cursor format update [VERIFY FIRST]"

---

## P3 Proposals ‚Äî Optional / Nice to Have

### P3.1: ADD ‚Äî `/pipeline` skill (run triangle in sequence)
**Why:** `/ctx ‚Üí /sculptor ‚Üí /arbiter` is always run sequentially (as we're doing right now). A single `/pipeline` skill would: run /ctx update, then /sculptor all, then /arbiter all ‚Äî outputting three files and a final summary. Removes friction for the most common workflow.
**What exactly:** Create `.claude/commands/pipeline.md` that calls the three skills in sequence with appropriate checks between steps.
**Impact:** Low-Medium ‚Äî convenience feature
**Effort:** Small ‚âà 1h
**Market context:** DX improvement. Pipelines are standard in modern dev tooling.
**Breaking:** üü¢ Non-breaking ‚Äî additive
**ROADMAP candidate:** Optional ‚Üí "Task 12: /pipeline skill"

---

### P3.2: ADD ‚Äî `install.ps1` (Windows PowerShell installer)
**Why:** Missing Windows-native installer. Ukrainian developer market has significant Windows presence. `npx` works cross-platform, so this is lower priority than install.sh fix ‚Äî but a proper Windows story matters for enterprise/corporate environments that restrict npx.
**What exactly:** Create `scripts/install.ps1` modeled after `install.sh` but with PowerShell syntax. Should be logically identical to the redesigned install.sh (implement after P1.2).
**Impact:** Low-Medium ‚Äî expands reach to Windows PowerShell users
**Effort:** Medium ‚âà 1d
**Market context:** Ukraine corporate/enterprise environments often restrict bash. PS1 is the native Windows way.
**Breaking:** üü¢ Non-breaking ‚Äî additive
**ROADMAP candidate:** Optional ‚Üí "Task 13: install.ps1 (Windows native)"

---

### P3.3: REMOVE ‚Äî Root debris (`task2.txt` and similar untracked files)
**Why:** `task2.txt` is an untracked research file in the project root. Pollutes `git status`, may confuse CI/future contributors. Minor but worth a clean.
**What exactly:** Delete `task2.txt`. Audit root for other untracked files that shouldn't be there. Add `*.txt` (or specific patterns) to `.gitignore` if recurring.
**Impact:** Low ‚Äî cosmetic
**Effort:** Small ‚âà 5 min
**Breaking:** üü¢ Non-breaking
**ROADMAP candidate:** Fold into any nearby cleanup task

---

## What NOT to Change

| What | Why to Keep |
|------|------------|
| **Dual-structure (dev ‚Üî npm-templates)** | Fundamental distribution architecture. Coupling cost is justified. |
| **Skills triangle (/ctx + /sculptor + /arbiter)** | Core competitive differentiator. Well-designed. Don't add more skills without clear need. |
| **presets.json v1.0** | Clean, honest. session_limit only, daily=null, no prices. Don't add prices back. |
| **@clack/prompts** | Right choice. Don't switch again. |
| **6 rule files (3 pairs)** | Reduced from 10. Could theoretically go lower (AGENTS.md could absorb .cursorrules) but the tool-specific benefit outweighs the merge savings. |
| **Security guards** | forbidden-trackers.json, pre-commit, PII detection ‚Äî all essential. Don't cut security. |
| **"Less is more" philosophy** | Every time this project added more (10 rule files, TOKEN_PRESETS, 4 presets), it created debt. Keep trusting this principle. |
| **post-push.sh session anchor** | Novel, useful, low overhead. Commit it. |

---

## Documentation Inconsistency (fix in passing)

`PROJECT_CONTEXT_MAP.md` says: **"2 pairs: Claude Code + Cursor"**
`ROADMAP.md` says: **"3 –ø–∞—Ä–∏"** (3 pairs)

Reality: **3 pairs** ‚Äî CLAUDE.md, .cursorrules, AGENTS.md. Fix the map when next updating.

---

## Next Steps
1. Discuss P1.2 (Wizard Redesign) scope ‚Äî this is the biggest pending work
2. Verify P2.3 (Cursor format) immediately ‚Äî if confirmed, becomes P1
3. P1.1 (token-limits.json delete) and P3.3 (task2.txt) can be done in 30 min
4. Run `/arbiter` to get execution order + risk scoring for these proposals
